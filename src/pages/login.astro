---
import Layout from "../layouts/Layout.astro";
import Notificacao from "../components/Notificacao.astro";

const errorMessages: Record<string, string> = {
  invalid_credentials: "Email ou senha incorretos. Tente novamente.",
  missing_fields: "Preencha email e senha.",
  invalid_request: "Requisição inválida.",
};

const error = Astro.url.searchParams.get("error");
const errorMessage = error ? errorMessages[error] ?? "Erro ao fazer login." : null;
const setupSuccess = Astro.url.searchParams.get("setup") === "success";
---

<Layout title="Login - Edgepress">
  <main class="min-h-screen flex items-center justify-center bg-base-200 p-4">
    <div class="card w-full max-w-md bg-base-100 shadow-xl">
      <div class="card-body">
        <h1 class="card-title justify-center text-2xl mb-4">Login</h1>

        {setupSuccess && (
          <Notificacao type="success" message="Configuração concluída. Faça login com o email e senha que você criou." dismissible className="mb-4" />
        )}
        {errorMessage && (
          <Notificacao type="error" message={errorMessage} dismissible className="mb-4" />
        )}

        <form
          action="/api/login"
          method="post"
          class="space-y-4"
        >
          <input type="hidden" name="callbackURL" value="/pt-br/admin" />
          <div class="form-control w-full">
            <label class="label" for="email">
              <span class="label-text">Email</span>
            </label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="seu@email.com"
              class="input input-bordered w-full"
              required
              autocomplete="email"
            />
          </div>

          <div class="form-control w-full">
            <label class="label" for="password">
              <span class="label-text">Senha</span>
            </label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="••••••••"
              class="input input-bordered w-full"
              required
              autocomplete="current-password"
            />
            <label class="label">
              <a href="/login/forgot-password" class="label-text-alt link link-hover">
                Esqueci senha
              </a>
            </label>
          </div>

          <div class="form-control mt-6">
            <button type="submit" class="btn btn-primary">
              Fazer login
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>
</Layout>
